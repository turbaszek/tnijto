<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TnijTo - link shortener</title>
    <!-- CSS -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">

    <link href="https://fonts.googleapis.com/css2?family=Nosifer&family=Titillium+Web:wght@300;400&display=swap" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/fdd938fea1.js" crossorigin="anonymous"></script>

</head>
<body>
    <header>
        <div id="logo">
            <h1>T</h1>
            <div class="triangle-up"></div>
        </div>
        <div id="switch-holder">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="customSwitch1">
                <label class="custom-control-label" for="customSwitch1">Toggle this switch element</label>
            </div>
        </div>
    </header>
    <main>
        <div class="banner">
            <h1>TNIJ TO!</h1>
            <h3>Twój skracacz linków online!</h3>
            <p>
                Tnij to, jeśli jest za długie i brzydkie! <br />
                Opcjonalnie: sam zaproponuje ładną nazwę uciętego adresu!
            </p>
        </div>
        <hr>
        <div class="form-holder">
            <form action="">
                <input type="text" placeholder="Długi i brzydki URI" id="link" autofocus />
                <a href="#tailored-cut-wrapper" id="show-tailored-cut" data-toggle="collapse">
                    Tnij na wymiar!<i class="fas fa-plus-circle" id="tailored-cut-icon"></i>
                </a>
                <div id="tailored-cut-wrapper" class="collapse">
                    <div>
                        <div>
                            <p>http://tnij.to/</p>
                        </div>
                        <div id="tailored-cut">
                            <input type="text" id="name" placeholder="Link na wymiar">
                        </div>
                    </div>
                </div>
                <button id="submit-button">Tnij!</button>
            </form>
            <div id="messages-wrap" class="hidden">
                <i class="fas fa-exclamation-circle warn red"></i>
                <p id="error-message"></p>
            </div>
        </div>
    </main>
    <footer>
        <a href="https://github.com/turbaszek/tnijto">
            <i class="fab fa-github"></i>
        </a>
    </footer>

    <script>
        const emptyInput = "Musisz podać jakiś URL."

        function post(url, data, success) {
            let params = typeof data == 'string' ? data : Object.keys(data).map(
                function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) }
            ).join('&');

            let xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
            xhr.open('POST', url);
            xhr.onreadystatechange = function() {
                if (xhr.readyState>3 && xhr.status==200) { success(xhr.responseText); }
            };
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(params);
            return xhr;
        }

        function submitForm() {
            let linkElement = document.getElementById("link")
            let nameElement = document.getElementById("name")
            let linkURL = linkElement.value
            let value = nameElement.value

            if (linkURL !== "") {
                post("/api/new", {'originalURL': linkURL, 'value': value}, showLink)
                linkElement.value = ""
                nameElement.value = ""

            } else {
                showMessage()
            }
        }

        function showLink(dataText) {
            let data = JSON.parse(dataText)
            console.log("Data txt: " + data)
            let url = data.GeneratedURL

            let msg = document.getElementById("generated-url");
            let generatedURL = document.getElementById("generated-url-value");

            if (msg.style.display === "none") {
                msg.style.display = "block";
                generatedURL.textContent = url;
            } else {
                generatedURL.textContent = url;
            }

        }

        function showMessage() {
            let messages = document.getElementById("messages-wrap");

            if(messages.classList.contains("hidden")) {
                messages.classList.remove("hidden")
                messages.classList.add("flex")
                document.getElementById("error-message").textContent = emptyInput
            }
        }

        window.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                submitForm();
            }
        });

        document.getElementById("submit-button").addEventListener("click", function(event){
            event.preventDefault()
            submitForm()
        });

        document.getElementById("show-tailored-cut").addEventListener("click", function(event){
            let icon = document.getElementById("tailored-cut-icon")

            if (icon.classList.contains("fa-plus-circle")) {
                icon.classList.replace("fa-plus-circle", "fa-minus-circle")

            } else {
                icon.classList.replace("fa-minus-circle", "fa-plus-circle")
            }
        });

    </script>
</body>
</html>

<!--<div class="flex-centered">*/
<!--    <div class="container center">*/
<!--        <div class="columns">*/
<!--            <div class="column col-1 col-mx-auto">*/
<!--                <h1 class="text-dark massive">Shorten your link!</h1>*/
<!--            </div>*/
<!--        </div>*/
<!--        <div class="columns">*/
<!--            <div class="column col-3 col-mx-auto">*/
<!--                <div class="input-group">*/
<!--                    <input id="link" type="text" class="form-input input-lg" placeholder="Terribly long link...">*/
<!--                    <button id="link-btn" class="btn btn-primary input-group-btn btn-lg" onclick="submitForm()">Submit</button>*/
<!--                </div>*/
<!--                <input class="form-input input-sm" id="name" type="text" value="" placeholder="Fancy short name..."/>*/

<!--                <p id="generated-url" style="display: none">Your link <cite id="generated-url-value"></cite></p>*/

<!--            </div>*/
<!--        </div>*/
<!--    </div>*/
<!--</div>*/
